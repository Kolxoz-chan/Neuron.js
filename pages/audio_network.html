<!DOCTYPE html>
<html>
<head>
   <meta charset="utf-8">
   <title>Neuron.js</title>
   <script src="../scripts/layers.js"></script>
   <script src="../scripts/neuron.js"></script>
   <link rel="stylesheet" href="../style.css"/>
</head>
<body>
<h1 align="center">Распознание Аудио</h1>
<p align="center"><a href="../index.html">Назад</a></p>
<hr>

 <div>

   <p align="center">
     <label for="audio-upload" class="custom-file-upload">Загрузить Аудио</label>
     <input type="file" id="audio-upload" accept=".mp3,.waw">
     <label>Амплитуда: </label>
     <input type="number" id="volume-bar" value="10000">
     <label>Масштаб: </label>
     <input type="number" id="scale-bar" value="1">
     <button onclick="run()">Запуск</button><br>
   </p>
  <canvas id="graph-node" width="1200" height="300" style="display: block; margin: auto;"></canvas>

   <script>

let canvas = document.getElementById("graph-node")
let context = canvas.getContext("2d")

function run()
{
  var audio_ctx = new (window.AudioContext || window.webkitAudioContext)();
  let el = document.getElementById("audio-upload")
  if(el.files.length)
  {
    let url = URL.createObjectURL(el.files[0])

    var request = new XMLHttpRequest();
    request.open('GET', url, true);
    request.responseType = 'arraybuffer';
    request.onload = () =>
    {
      audio_ctx.decodeAudioData(request.response, (buffer) =>
      {
        let arr = buffer.getChannelData(0)
        let volume = document.getElementById("volume-bar").value
        let scale = document.getElementById("scale-bar").value
        
        context.clearRect(0, 0, canvas.width, canvas.height);
        for(let i=0; i<arr.length/scale; i++)
        {
          let sum = arr[i]
          let value = Math.round(sum * volume)

          context.fillRect(i, 150, 1, -value)
        }
        
      })
    }
    request.send();
  }
  else alert("File is not selected")
}

   </script>
 </div>
</body>
</html>
