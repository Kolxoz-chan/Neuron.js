<!DOCTYPE html>
<html>
 <head>
    <meta charset="utf-8">
    <title>Neuron.js</title>
    <script src="layers.js"></script>
    <script src="neuron.js"></script>
    <link rel="stylesheet" href="style.css"/>
 </head>
 <body>
  <p align="center" id="game"></p>
  <p align="center"><button onclick="for(let i=0; i<500; i++)Game.random_select()">Обучить</button></p>
  <div>
    <script>
      class Game
      {
        static id = ""
        static matrix = []
        static buttons = []
        static network = null

        static init(id)
        {
          Game.id = id;
          Game.network = new Perceptron([9, 9, 9])
          let block = document.getElementById(Game.id)

          for(let y=0; y<3; y++)
          {
            for(let x=1; x<=3; x++)
            {
              let index = y * 3 + x - 1
              let button = document.createElement("button")
 
              button.style.padding = "10px 15px"
              button.style.border = "1px solid black"
              Game.buttons[index] = button
              button.onclick = function()
              {
                Game.setValue(index, -1)
                Game.network.forward(Game.getValues())
                let neuron_id = Game.network.getStrongestNeuron();
				        let neuron = Game.network.getNeuron(2, neuron_id)
				
                if(!Game.setValue(neuron_id, 1))
                {
                  neuron.backward(-0.1)
				          console.log(neuron)

                  Game.reset()
                }

              }

              block.appendChild(button)
            }
            block.appendChild(document.createElement("br"))
          }

          Game.reset()
        }
		
		static random_select()
		{
			let buttons = []
			for(let i=0; i<Game.matrix.length; i++)
			{
				if(Game.matrix[i] == 0)
				{
				
					buttons.push(Game.buttons[i])
				}
			}
			if(buttons.length)
			{
				buttons[Math.floor(Math.random() * buttons.length)].click();
			}
		}

        static reset()
        {
          for(let i=0; i<9; i++)
          {
            Game.setValue(i, 0)
          }
        }

        static setValue(index, value)
        {
          if(Game.matrix[index] != 0 && value != 0) return false 

          Game.matrix[index] = value

          let button = Game.buttons[index]
          button.innerHTML = value
          if(value == -1) button.style.backgroundColor = "red"
          else if(value == 1) button.style.backgroundColor = "blue"
          else button.style.backgroundColor = "white"

          return true
        }

        static getValues()
        {
          return Game.matrix
        }
      }

      Game.init("game")
   

    </script>
  </div>
 </body>
</html>
